<% layout('layout') %>

<div class="max-w-3xl mx-auto mt-10 p-4">
  <h1 class="text-3xl font-bold mb-4 text-center">Selamat Datang!</h1>
  <p class="text-center text-gray-700 mb-6">
    Silakan pilih opsi voting Anda atau tambahkan opsi sendiri.
  </p>

  <% if (polls.length > 0) { %>
    <div class="space-y-8">
      <% polls.forEach(poll => { %>
        <div class="bg-white shadow-md rounded-lg p-6">
          <h3 class="text-xl font-semibold mb-2"><%= poll.title %></h3>
          <p class="text-sm text-gray-500 mb-4">
            <em>Dibuat oleh: <%= poll.User?.username || "Tidak diketahui" %></em>
          </p>

          <form action="/vote" method="POST" class="space-y-4">
            <div>
              <label class="block text-gray-700 font-medium mb-1">Pilih Opsi:</label>
              <select
                name="optionId"
                id="option-<%= poll.id %>"
                onchange="clearCustomOption(<%= poll.id %>)"
                class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                required
              >
                <option value="">-- Pilih Opsi --</option>
                <% poll.Options.forEach(option => { %>
                  <option value="<%= option.id %>"><%= option.text %></option>
                <% }) %>
              </select>
            </div>

            <div>
              <label class="block text-gray-700 font-medium mb-1">Atau masukkan pilihan sendiri:</label>
              <input
                type="text"
                name="customOption"
                id="customOption-<%= poll.id %>"
                oninput="clearSelect(<%= poll.id %>)"
                placeholder="Masukkan opsi sendiri..."
                class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>

            <input type="hidden" name="pollId" value="<%= poll.id %>" />

            <button
              type="submit"
              class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition"
            >
              Vote
            </button>
          </form>
        </div>
      <% }) %>
    </div>
  <% } else { %>
    <p class="text-center text-gray-600">Tidak ada polling yang tersedia.</p>
  <% } %>
</div>

<script>
  function clearSelect(pollId) {
    document.getElementById("option-" + pollId).value = "";
  }

  function clearCustomOption(pollId) {
    document.getElementById("customOption-" + pollId).value = "";
  }
</script>
